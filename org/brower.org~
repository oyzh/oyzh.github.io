#+HTML_MATHJAX: align:"center" mathml:t path:"http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" indent: 0em 
#+HTML_HEAD: <link rel="stylesheet" type="text/css" href="/css/style.css">
#+BEGIN_HTML
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({ TeX: { equationNumbers: {autoNumber: "AMS"} } });
</script>
#+END_HTML
#+OPTIONS: author:nil
#+OPTIONS: creator:nil
#+OPTIONS: timestamp:nil
#+OPTIONS: num:nil
-----
#+TITLE:高级计算机网络课程报告——Speeding up Web Page Loads with Shandian
#+TOC: headlines 2
#+OPTIONS: toc:nil

* 简介
本文主要是介绍论文[1]的工作，文章中提出了Shandian来加速页面加载。提起网络，我们首先想到的都会是各种网站，因为这是我们使用网络最频繁的方式，也是我们使用互联网的入口。通常，我们通过各种浏览器进行网页浏览，而之所以介绍介绍本文，是因为我对浏览器是如何一步步显示网页不是很了解，正好这篇文章从页面加载时间这一视角出发，让我们可以全方位了解浏览器是如何工作的。

端到端的页面加载时间指是从浏览器发出请求开始到浏览器显示页面结束的时间段。页面加载时间是衡量用户体验的重要的指标，并关系到商业回报，因此它一直受到广泛的研究。论文考察了影响页面加载速度的各种因素，并提出了新的方法"Shandian"来加速页面的加载。

* 背景知识
本章不仅包括论文中提到的背景知识，也有我自己总结的网页加载的基础知识。
** 客户端服务器模型
网页一般是放在远端的服务器上，本机的浏览器作为客户端，而客户端和服务器端的交流是通过应用层的HTTP协议。概括来说，客户端向服务器端发送各种请求，比如GET、HEAD或POST等，由于是按照标准协议发送的，因此服务器端可以解析这些请求，并根据请求向客户端发送它要求的资源。我们在套接字上建立这些操作，由于底层的封装，可以假设客户端和服务器端之间有一条可以传输资源和协议的通道，在这之上我们就可以只考虑页面的传输问题。

** 页面加载
一个网页包含了许多对象，包括HTML、JavaScript、CSS、和视频等。HTML是用来描述网页内容的标记语言。CSS是用来描述HTML中元素属性的一系列规则的集合，比如在CSS中可以设定HTML中标题的颜色和大小。JavaScript通常用来向网页中添加动态内容，它可以控制HTML，比如增加HTML元素，或者动态的修改元素的属性。CSS和JavaScript本身也作为HTML的一个元素，不过一般来说会把它们写在单独的文件里，而在HTML中对应的元素会引用对应的文件。

在得到HTML文件后，浏览器运行HTML语法解析器来分析HTML，由于HTML中有引用其他对象，这个过程中也需要把这些对象下载下来。HTML的解析结果是文档对象类型(document object model,DOM)，这是页面在内存中的一种表示，这类似于编译器设计中的抽象语法树，DOM树向JavaScript提供了一个公共接口用于修改页面。在浏览器得到DOM树后，它促发一个load事件，用来将DOM树代表的页面显示给用户。

在页面加载过程中有很多依赖关系，由于不管是CSS还是JavaScript都可以改变DOM，为了一致性必须按顺序处理，也就必须在解析HTML时要等待和解析所依赖的对象。如图1，在解析0.html时，当遇到外链接1.css时，就需要暂停0.html的解析，转而下载并解析1.css，同样遇到2.js时也需要暂停0.html的解析，转而下载并解析2.js。为了保证这种页面正确被加载，HTML的解析过程会经常性的被打断，这会使页面加载变慢。而HTML、CSS和JavaScript本身的组成和它们的组织结构是影响页面加载时间的重要因素。
#+CAPTION: web页面的内容
#+NAME: fig:SED-HR4049
[[./p1.png]]

** 页面加载不高效的原因
具体的导致页面加载效率不高的原因有以下几点：
1. 很多没有使用的CSS规则：很多规则是准备以后的交互过程会使用，而第一次页面渲染用不到。而这导致了更长的传输时间和更长的解析CSS时间。
2. JS和CSS的打断HTML解析。
3. 额外的网络往返：web对象不是一批一批加载的，而是按顺序加载，这导致一个页面的加载会导致很多网络时延。

* 设计
Shandian将页面加载过程分成两部分，一部分在代理服务器上处理，一部分在客户端处理，代理服务器有强大的计算能力，因此客户端的处理得到简化从而降低了页面加载时间。代理服务器处理一些初始页面需要的信息，客户端可以更快速的响应用户的交互，用户感受不到代理服务器的存在，从而提高了用户体验度。Opera mini和Amozon Silk也采用类似的机制，区别在于这两个浏览器的客户端只用于显示页面，而像JavaScript和CSS都在代理服务器端运行，而Shandian的客户端具有浏览器所有功能，也就是可以运行JavaScript，我们通过判断哪些应该运行在代理服务器，哪些应该允许在客户端可以使整个系统的性能得到比Silk和Opera mini更好的优化。

在让页面显示正确的前提下，我们可以调整页面处理的步骤来最小化网络延迟和计算花费。需要实现以下几点：
+ 如何确定哪些是第一次页面加载需要的要素，比如前面提到的CSS中很多规则在第一次页面加载时根本用不到，准确地找到这些要素是降低加载时间的关键。
+ 分离式结构的浏览器需要和一般浏览器表现出来的功能一模一样。
+ Shandian可以降低第一次页面的加载时间，也需要保证用户之后和网页的交互。

访问网页时我们很看重页面响应时间，像前面提到的一般页面包含很多对象，通过用代理服务器处理可以让我们更快结果，在初始加载一个页面时，这个系统主要从以下几个方面提高客户端的响应速度：
1. JavaScript： JavaScript的允许很消耗时间，它们主要是对HTML元素的一些动态修改，因此Shandian的做法是在代理服务器上允许初始页面的JavaScript，在客户端不用允许JavaScript。
2. CSS：CSS也需要解析，从而打断HTML的渲染，由客户端直接处理CSS也需要避免。CSS文件是对HTML中元素进行控制，因此一般运行CSS的步骤是CSS解析、为HTML中的元素选择对应的CSS规则和用对应的规则来生成元素一些的styles。可以将前两个步骤放到代理服务器上处理，只把初始页面要用的CSS规则传递到客户端。
3. 通过前两步处理，代理服务器将不包含JavaScript的HTML发送给客户端，CSS也已经过解析和选择，客户端可以非常快速的构造DOM。整个过程不会被打断，也不会运行JavaScript程序和CSS。

* 总结
过去我对网站建设、服务器运行原理和应用层的HTTP协议有一定的了解，但是不了解浏览器渲染网页的过程，对CSS和JavaScript在页面中的功能也不清楚。结合本文和网络上的资源，我对浏览器也有了比较新的认识。HTML的元素是控制页面的基础，浏览器解析HTML来生成DOM并最终渲染页面。HTML元素有很多属性，页面也有很多风格，这些描述都可以放在CSS文件中并得到解析。而JavaScript可以动态修改DOM来影响页面并达到动态效果。

加速初始页面加载是论文研究的主题，Shandian这种分离浏览器架构可以很好的完成这个目标，而Amozon Silk和Opera mini的实现表明这是可行的。结合当前云计算等的快速发展，我觉得这种类型的浏览器会是以后的趋势，甚至有可能会改变整个网页制作的方式，以更加适应这种客户端-代理服务器架构。
[1] Speeding up Web Page Loads with Shandian. Xiao Sophia Wang, Arvind Krishnamurthy and David Wetherall. NSDI 16.
-----
#+BEGIN_HTML
<a href="http://oyzh.github.io">Back to Homepage</a>
<br>
<a href="http://github.com/oyzh">Github</a>
#+END_HTML
